
<% unless params[:recipe_id].present? %>
  <div class="box1">
    <ul class="nav nav-pills nav-fill justify-content-center" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link" href="<%= user_todaymeals_path(@user, start_time: params[:start_time], start_date: params[:start_date]) %>">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="<%= user_recipes_path(@user, timezone_id: params[:timezone_id], start_time: params[:start_time], start_date: params[:start_date]) %>">Record</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="<%= user_meals_analysis_index_path(@user, start_time: params[:start_time], start_date: params[:start_date]) %>">Analysis</a>
      </li>
    </ul>
  </div>
  
  <div class="box1">
    <ul class="nav nav-fill justify-content-center" id="myTab" role="tablist">
      <% @timezones.each do |timezone| %>
        <li class="nav-item">
          <% if timezone.id == params[:timezone_id].to_i %>
            <a class="nav-link active" href="<%= user_myfoods_path(@user, timezone_id: timezone, start_time: params[:start_time], start_date: params[:start_date]) %>"><%= timezone.time_zone %></a>
          <% else %>
            <a class="nav-link" href="<%= user_myfoods_path(@user, timezone_id: timezone, start_time: params[:start_time], start_date: params[:start_date]) %>"><%= timezone.time_zone %></a>
          <% end %>
      <% end %>
    </ul>
  </div>
  
  <div class="box1">
    <ul class="nav nav-fill justify-content-center" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link" href="<%= user_recipes_path(@user, timezone_id: params[:timezone_id], start_time: params[:start_time], start_date: params[:start_date]) %>">Recipe</a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="<%= user_myfoods_path(@user, timezone_id: params[:timezone_id], start_time: params[:start_time], start_date: params[:start_date]) %>">Myfood</a>
      </li>
    </ul>
  </div>
  
  <div class="row">
    <div class="mx-auto">
      <%= link_to(user_apifoods_path(@user, food_name: "", start_time: params[:start_time], start_date: params[:start_date]), class: "btn btn-sm btn-original") do %>
        <i class="far fa-plus-square fa-lg">API食品追加</i>
      <% end %>
      <%= link_to(new_user_myfood_path(@user, food_name: "", start_time: params[:start_time], start_date: params[:start_date]), class: "btn btn-sm btn-original") do %>
        <i class="far fa-plus-square fa-lg">食品追加</i>
      <% end %>
    </div>
  </div>
<% end %>

<% if params[:recipe_id].present? %>
  <ul class="nav nav-fill justify-content-center" id="myTab" role="tablist">
    <li class="nav-item">
      <% if params[:before] == "new" %>
        <a class="nav-link" href="<%= new_user_todaymeal_recipe_path(@user, switching: "record", recipe_id: params[:recipe_id], timezone_id: params[:timezone_id], start_time: params[:start_time], start_date: params[:start_date]) %>"><i class="fas fa-undo-alt">戻る</i></a>
      <% else %>
        <a class="nav-link" href="<%= edit_user_todaymeal_recipe_path(@user, @todaymeal_recipe, switching: "record", recipe_id: params[:recipe_id], timezone_id: params[:timezone_id], start_time: params[:start_time], start_date: params[:start_date]) %>"><i class="fas fa-undo-alt">戻る</i></a>
      <% end %>
    </li>
  </ul>
  
  <div class="box1">
    <div class="row">
      <div class="mx-auto">
        <h5>
          <%= @recipe.recipe_name if @recipe.present? %>
        </h5>
      </div>
    </div>
    <table class="table">
      <% @recipefoods.each do |recipefood| %>
      <% @myfood = @user.myfoods.find(recipefood.myfood_id) %>
        <thead>
          <tr>
            <th colspan="8"><%= @myfood.food_name %>(<%= recipefood.amount %>個分)</th>
          </tr>
          <tr>
            <% @attribute_names.each do |attribute_name| %>
              <th class="align-middle"><%= attribute_name %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
            <tr>
              <td><%= recipefood_format(@myfood.calorie, recipefood.amount) %></td>
              <td><%= recipefood_format(@myfood.protein, recipefood.amount) %></td>
              <td><%= recipefood_format(@myfood.fat, recipefood.amount) %></td>
              <td><%= recipefood_format(@myfood.carbo, recipefood.amount) %></td>
              <td><%= recipefood_format(@myfood.sugar, recipefood.amount) %></td>
              <td><%= recipefood_format(@myfood.dietary_fiber, recipefood.amount) %></td>
              <td><%= recipefood_format(@myfood.salt, recipefood.amount) %></td>
            </tr>
        </tbody>
      <% end %>
      <tfoot>
        <tr>
          <th colspan="8">合計</th>
        </tr>
        <tr>
          <% @recipe_myfoods.each do |recipe_myfood| %>
            <td><%= recipe_myfood %></td>
          <% end %>
        </tr>
      </tfoot>
    </table>
  </div>
<% end %>
<br>
<div class="row">
  <div class="mx-auto">
    <%= paginate @myfoods %>
  </div>
</div>

<div class="box1">
  <div class="row">
    <div class="col-md-12">
      <table class="table table-striped">
        <thead>
          <tr>
            <th><%= Myfood.human_attribute_name(:food_name) %></th>
            <th><%= Myfood.human_attribute_name(:calorie) %></th>
          </tr>
        </thead>
        <tbody>
          <% @myfoods.each do |myfood| %>
            <% unless params[:recipe_id].present? %>
              <tr data-href=<%= new_user_todaymeal_path(@user, switching: "record", myfood_id: myfood, timezone_id: params[:timezone_id], start_time: params[:start_time], start_date: params[:start_date]) %>>
            <% else %>  
              <tr data-href=<%= new_user_recipefood_path(@user, switching: "record", id: params[:id], before: params[:before], recipe_id: params[:recipe_id], myfood_id: myfood, timezone_id: params[:timezone_id], start_time: params[:start_time], start_date: params[:start_date]) %>>
            <% end %>
              <td>
                <%= myfood.food_name %>
              </td>
              <td><%= myfood.calorie %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div class="row">
  <div class="mx-auto">
    <%= paginate @myfoods %>
  </div>
</div>
